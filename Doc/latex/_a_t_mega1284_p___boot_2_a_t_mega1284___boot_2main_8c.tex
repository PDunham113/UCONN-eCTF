\hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c}{}\subsection{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.c File Reference}
\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c}\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
{\ttfamily \#include $<$avr/io.\+h$>$}\newline
{\ttfamily \#include $<$avr/boot.\+h$>$}\newline
{\ttfamily \#include $<$avr/wdt.\+h$>$}\newline
{\ttfamily \#include $<$avr/interrupt.\+h$>$}\newline
{\ttfamily \#include $<$avr/pgmspace.\+h$>$}\newline
{\ttfamily \#include \char`\"{}uart.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}A\+E\+S\+\_\+lib.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}secret\+\_\+build\+\_\+output.\+txt\char`\"{}}\newline
Include dependency graph for main.\+c\+:
% FIG 0
\subsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a43bafb28b29491ec7f871319b5a3b2f8}{F\+\_\+\+C\+PU}~7300000\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a62634036639f88eece6fbf226b45f84b}{B\+A\+UD}~115200\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a16d349d854d023bed03d4af1f959258b}{U\+P\+D\+A\+T\+E\+\_\+\+P\+IN}~P\+I\+N\+B2
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a629eca34f36fcebadd517638668edc5b}{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN}~P\+I\+N\+B3
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_adb5b0e47cb4aa23f0296ea2929cb8965}{C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN}~P\+I\+N\+B4
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a0b29e6d93aad7f8976b56e2e6dafa8a1}{R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH}~10
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a6f6489887e08bff4887d0bc5dcf214d8}{A\+CK}~((unsigned char)0x06)
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a958518a45b12053ae33606ee7cb68a55}{N\+A\+CK}~((unsigned char)0x15)
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}~16\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}~32\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a6bfdf0e01e9d3de942e38ba284d8ada3}{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE}~24\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aa86726c202d06362938bb5f240af754b}{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE}~8192\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ae3ef7bba113f663df6996f286b632a3f}{E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE}~4096\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3f2bd9d166029160170f5a854aabdb06}{L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER}~126\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a7a83bed0a2957de15d4d53c0fdda30c6}{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE}~48\+UL
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a5673c89974df0bf43ae1875b90770753}{A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON}~0\+U\+L $\ast$ L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac72f8903909f218f65f1ed4c71672c8b}{M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON}~1\+U\+L $\ast$ (\+L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R -\/ 6) $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac7411bb1c1fe4795680521813de49b83}{E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}~1\+U\+L $\ast$ L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aefc050cbb6b5bd75ca2294fbca6b51a1}{D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}~2\+U\+L $\ast$ L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a9f8baeb83b25f1f50df86b9ca7979a84}{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON}~480\+U\+L $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2bbf7f4d4680bb65730e1cce022349ee}{F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}~479\+U\+L $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\item 
\#define \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_abbdb10a4e65490e6532b4869a0cda533}{B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}~511\+U\+L $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE
\end{DoxyCompactItemize}
\subsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ab7210aaba738ad94e5fd964a5570cee6}{init\+Timer0} (void)
\begin{DoxyCompactList}\small\item\em Initialize Timer0 for clock switching. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3196fd27b969056c23b17850d0839e85}{enable\+Clock\+Switching} (void)
\begin{DoxyCompactList}\small\item\em Starts Timer0, enabling Clock Switching. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a86b1b361f8d4d2fe6b8b428feba54867}{disable\+Clock\+Switching} (void)
\begin{DoxyCompactList}\small\item\em Stops Timer0, disabling Clock Switching. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a9401b6b502308eaaa5813082af1c3046}{load\+\_\+firmware} (void)
\begin{DoxyCompactList}\small\item\em Loads a new firmware image and release message. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aadd0c9265bc34afbab613a5935d63281}{boot\+\_\+firmware} (void)
\begin{DoxyCompactList}\small\item\em Ensures the firmware is loaded correctly and boots it up. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a5d4adc248ad2605b7c045108c6a48b1b}{readback} (void)
\begin{DoxyCompactList}\small\item\em Interfaces with host readback tool. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a10ff4a55a184a56510f959b90ddb74e4}{configure} (void)
\begin{DoxyCompactList}\small\item\em Interfaces with host configure tool. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a16ce9e8fa9487889a54985d19a3fe160}{calc\+Hash} (uint8\+\_\+t $\ast$key, uint16\+\_\+t start\+Page, uint16\+\_\+t end\+Page, uint8\+\_\+t $\ast$hash, uint8\+\_\+t E\+E\+Flag)
\begin{DoxyCompactList}\small\item\em Calculates a hash of a memory section. \end{DoxyCompactList}\item 
void \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2695b90a2a64b6fe11e14c1e2d13f26f}{program\+\_\+flash} (uint32\+\_\+t page\+\_\+address, unsigned char $\ast$data)
\begin{DoxyCompactList}\small\item\em Programs a page of A\+T\+Mega1284P flash memory. \end{DoxyCompactList}\item 
int \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\end{DoxyCompactItemize}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
uint16\+\_\+t fw\+\_\+version \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a4710eb249c76fbcee86e3b3ea93f7ea7}{E\+E\+M\+EM} = 1
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a1c67bcd43e103c8093bb6036690ab2e3}{hash\+Key} \mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = H\+\_\+\+K\+EY
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a36bf49f5e29276a4e9e96bf39a621f80}{readback\+Hash\+Key} \mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+H\+\_\+\+K\+EY
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3604d93cc7032be26dcca6e694afef50}{firmware\+Key} \mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = F\+W\+\_\+\+K\+EY
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ab712a58833cf27f708f308e3e491a3e7}{readback\+Key} \mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+\_\+\+K\+EY
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac23353dfc159499579eee2c03444f504}{firmware\+IV} \mbox{[}\hyperlink{bootloader_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}\mbox{]} = F\+W\+\_\+\+IV
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a1b8a8d208ede5763090cb2498cb954de}{readback\+IV} \mbox{[}\hyperlink{bootloader_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+\_\+\+IV
\item 
uint8\+\_\+t \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a68fe00d921fd371e6ed4b5e5c9350fd6}{readback\+Password} \mbox{[}\hyperlink{bootloader_2main_8c_a6bfdf0e01e9d3de942e38ba284d8ada3}{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+\_\+\+PW
\end{DoxyCompactItemize}


\subsubsection{Macro Definition Documentation}
\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a6f6489887e08bff4887d0bc5dcf214d8}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a6f6489887e08bff4887d0bc5dcf214d8}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!A\+CK@{A\+CK}}
\index{A\+CK@{A\+CK}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{A\+CK}{ACK}}
{\footnotesize\ttfamily \#define A\+CK~((unsigned char)0x06)}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a5673c89974df0bf43ae1875b90770753}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a5673c89974df0bf43ae1875b90770753}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON@{A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON@{A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON}{APPLICATION\_SECTION}}
{\footnotesize\ttfamily \#define A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON~0\+U\+L $\ast$ L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a62634036639f88eece6fbf226b45f84b}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a62634036639f88eece6fbf226b45f84b}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!B\+A\+UD@{B\+A\+UD}}
\index{B\+A\+UD@{B\+A\+UD}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{B\+A\+UD}{BAUD}}
{\footnotesize\ttfamily \#define B\+A\+UD~115200\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE@{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}}
\index{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE@{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}{BLOCK\_SIZE}}
{\footnotesize\ttfamily \#define B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE~16\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_abbdb10a4e65490e6532b4869a0cda533}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_abbdb10a4e65490e6532b4869a0cda533}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON@{B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON@{B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}{BOOT\_HASH\_SECTION}}
{\footnotesize\ttfamily \#define B\+O\+O\+T\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON~511\+U\+L $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a9f8baeb83b25f1f50df86b9ca7979a84}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a9f8baeb83b25f1f50df86b9ca7979a84}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON@{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON@{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON}{BOOTLDR\_SECTION}}
{\footnotesize\ttfamily \#define B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+E\+C\+T\+I\+ON~480\+U\+L $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aa86726c202d06362938bb5f240af754b}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aa86726c202d06362938bb5f240af754b}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE@{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE}}
\index{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE@{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE}{BOOTLDR\_SIZE}}
{\footnotesize\ttfamily \#define B\+O\+O\+T\+L\+D\+R\+\_\+\+S\+I\+ZE~8192\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_adb5b0e47cb4aa23f0296ea2929cb8965}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_adb5b0e47cb4aa23f0296ea2929cb8965}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN@{C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN}}
\index{C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN@{C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN}{CONFIGURE\_PIN}}
{\footnotesize\ttfamily \#define C\+O\+N\+F\+I\+G\+U\+R\+E\+\_\+\+P\+IN~P\+I\+N\+B4}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aefc050cbb6b5bd75ca2294fbca6b51a1}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aefc050cbb6b5bd75ca2294fbca6b51a1}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON@{D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON@{D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}{DECRYPTED\_SECTION}}
{\footnotesize\ttfamily \#define D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON~2\+U\+L $\ast$ L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ae3ef7bba113f663df6996f286b632a3f}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ae3ef7bba113f663df6996f286b632a3f}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE@{E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE}}
\index{E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE@{E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE}{EEPROM\_SIZE}}
{\footnotesize\ttfamily \#define E\+E\+P\+R\+O\+M\+\_\+\+S\+I\+ZE~4096\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac7411bb1c1fe4795680521813de49b83}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac7411bb1c1fe4795680521813de49b83}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON@{E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON@{E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON}{ENCRYPTED\_SECTION}}
{\footnotesize\ttfamily \#define E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON~1\+U\+L $\ast$ L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a43bafb28b29491ec7f871319b5a3b2f8}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a43bafb28b29491ec7f871319b5a3b2f8}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!F\+\_\+\+C\+PU@{F\+\_\+\+C\+PU}}
\index{F\+\_\+\+C\+PU@{F\+\_\+\+C\+PU}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{F\+\_\+\+C\+PU}{F\_CPU}}
{\footnotesize\ttfamily \#define F\+\_\+\+C\+PU~7300000\+UL}

bootloader.\+c

If Port B Pin 2 (P\+B2 on the Proto\+Stack board) is pulled to ground the bootloader will wait for data to appear on U\+A\+R\+T1 (which will be interpreted as an updated firmware package).

If the P\+B2 pin is N\+OT pulled to ground, but Port B Pin 3 (P\+B3 on the Proto\+Stack board) is pulled to ground, then the bootloader will enter flash memory readback mode.

If the P\+B3 pin is N\+OT pulled to ground, but Port B Pin 4 (P\+B4 on the Proto\+Stack board) is pulled to ground, then the bootloader will enter bootloader configure mode.

If N\+E\+I\+T\+H\+ER of these pins are pulled to ground, then the bootloader will execute the application from flash.

The load\+\_\+firmware function details the structure of the firmware upload messages.

The readback function details the structure of the readback request messages.

See \hyperlink{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2695b90a2a64b6fe11e14c1e2d13f26f}{program\+\_\+flash()} for information on the process of programming the flash memory. Note that if no data is received after 2 seconds, the bootloader will time out and reset. \mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2bbf7f4d4680bb65730e1cce022349ee}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2bbf7f4d4680bb65730e1cce022349ee}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON@{F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON@{F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON}{FIRM\_HASH\_SECTION}}
{\footnotesize\ttfamily \#define F\+I\+R\+M\+\_\+\+H\+A\+S\+H\+\_\+\+S\+E\+C\+T\+I\+ON~479\+U\+L $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!K\+E\+Y\+\_\+\+S\+I\+ZE@{K\+E\+Y\+\_\+\+S\+I\+ZE}}
\index{K\+E\+Y\+\_\+\+S\+I\+ZE@{K\+E\+Y\+\_\+\+S\+I\+ZE}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{K\+E\+Y\+\_\+\+S\+I\+ZE}{KEY\_SIZE}}
{\footnotesize\ttfamily \#define K\+E\+Y\+\_\+\+S\+I\+ZE~32\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3f2bd9d166029160170f5a854aabdb06}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3f2bd9d166029160170f5a854aabdb06}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER@{L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER}}
\index{L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER@{L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER}{LOAD\_FIRMWARE\_PAGE\_NUMBER}}
{\footnotesize\ttfamily \#define L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+ER~126\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac72f8903909f218f65f1ed4c71672c8b}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac72f8903909f218f65f1ed4c71672c8b}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON@{M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON}}
\index{M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON@{M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON}{MESSAGE\_SECTION}}
{\footnotesize\ttfamily \#define M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON~1\+U\+L $\ast$ (\+L\+O\+A\+D\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+P\+A\+G\+E\+\_\+\+N\+U\+M\+B\+E\+R -\/ 6) $\ast$ S\+P\+M\+\_\+\+P\+A\+G\+E\+S\+I\+ZE}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a958518a45b12053ae33606ee7cb68a55}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a958518a45b12053ae33606ee7cb68a55}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!N\+A\+CK@{N\+A\+CK}}
\index{N\+A\+CK@{N\+A\+CK}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{N\+A\+CK}{NACK}}
{\footnotesize\ttfamily \#define N\+A\+CK~((unsigned char)0x15)}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a0b29e6d93aad7f8976b56e2e6dafa8a1}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a0b29e6d93aad7f8976b56e2e6dafa8a1}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH@{R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH}}
\index{R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH@{R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH}{RAND\_CLOCK\_SWITCH}}
{\footnotesize\ttfamily \#define R\+A\+N\+D\+\_\+\+C\+L\+O\+C\+K\+\_\+\+S\+W\+I\+T\+CH~10}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a6bfdf0e01e9d3de942e38ba284d8ada3}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a6bfdf0e01e9d3de942e38ba284d8ada3}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE@{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE}}
\index{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE@{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE}{READBACK\_PASSWORD\_SIZE}}
{\footnotesize\ttfamily \#define R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE~24\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a629eca34f36fcebadd517638668edc5b}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a629eca34f36fcebadd517638668edc5b}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN@{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN}}
\index{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN@{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN}{READBACK\_PIN}}
{\footnotesize\ttfamily \#define R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+IN~P\+I\+N\+B3}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a7a83bed0a2957de15d4d53c0fdda30c6}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a7a83bed0a2957de15d4d53c0fdda30c6}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE@{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE}}
\index{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE@{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE}{READBACK\_REQUEST\_SIZE}}
{\footnotesize\ttfamily \#define R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+ZE~48\+UL}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a16d349d854d023bed03d4af1f959258b}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a16d349d854d023bed03d4af1f959258b}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!U\+P\+D\+A\+T\+E\+\_\+\+P\+IN@{U\+P\+D\+A\+T\+E\+\_\+\+P\+IN}}
\index{U\+P\+D\+A\+T\+E\+\_\+\+P\+IN@{U\+P\+D\+A\+T\+E\+\_\+\+P\+IN}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{U\+P\+D\+A\+T\+E\+\_\+\+P\+IN}{UPDATE\_PIN}}
{\footnotesize\ttfamily \#define U\+P\+D\+A\+T\+E\+\_\+\+P\+IN~P\+I\+N\+B2}



\subsubsection{Function Documentation}
\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aadd0c9265bc34afbab613a5935d63281}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_aadd0c9265bc34afbab613a5935d63281}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!boot\+\_\+firmware@{boot\+\_\+firmware}}
\index{boot\+\_\+firmware@{boot\+\_\+firmware}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{boot\+\_\+firmware()}{boot\_firmware()}}
{\footnotesize\ttfamily void boot\+\_\+firmware (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Ensures the firmware is loaded correctly and boots it up. 

This function calculates the hash of the firmware section and compares it to the one currently stored.

H\+A\+SH C\+O\+R\+R\+E\+CT -\/ The function prints a release message if available, and boots. The Watchdog Timer is disabled before boot.

H\+A\+SH I\+N\+C\+O\+R\+R\+E\+CT -\/ The function indicates firmware error and resets. 
\begin{DoxyItemize}
\item C\+H\+E\+CK H\+A\+SH $\ast$/ 
\end{DoxyItemize}\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a16ce9e8fa9487889a54985d19a3fe160}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a16ce9e8fa9487889a54985d19a3fe160}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!calc\+Hash@{calc\+Hash}}
\index{calc\+Hash@{calc\+Hash}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{calc\+Hash()}{calcHash()}}
{\footnotesize\ttfamily void calc\+Hash (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{key,  }\item[{uint16\+\_\+t}]{start\+Page,  }\item[{uint16\+\_\+t}]{end\+Page,  }\item[{uint8\+\_\+t $\ast$}]{hash,  }\item[{uint8\+\_\+t}]{E\+E\+Flag }\end{DoxyParamCaption})}



Calculates a hash of a memory section. 

This function calculates the C\+B\+C-\/\+M\+AC hash of a section in flash or in E\+E\+P\+R\+OM. The section is indexed by pages, where 1 page = 256 bytes. Both E\+E\+P\+R\+OM and F\+L\+A\+SH are indexed through the same method. The final byte is used as a flag to indicate which region of memory is being hashed. \begin{DoxyVerb}0 - Hash Flash  Memory

1 - Hash EEPROM Memory
\end{DoxyVerb}


The hash array fed to this function M\+U\+ST be filled with zeros initially, or the hashing will not work correctly. The start\+Page parameter refers to the first page to be hashed. The end\+Page parameter does not refer to the last page to be hashed, but to the first page to N\+OT hash.


\begin{DoxyParams}{Parameters}
{\em key} & Pointer to 32-\/byte array containing the A\+E\+S-\/256 key. \\
\hline
{\em start\+Page} & Starting 256-\/byte page of memory to hash (this page W\+I\+LL be hashed) \\
\hline
{\em end\+Page} & Ending 256-\/byte page of memory to hash (this page will N\+OT be hashed) \\
\hline
{\em hash} & Pointer to a 16-\/byte hash array. Must be initialized to all zeros. \\
\hline
{\em E\+E\+Flag} & Flag to indicate memory type. 0 -\/ Flash; 1 -\/ E\+E\+P\+R\+OM \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a10ff4a55a184a56510f959b90ddb74e4}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a10ff4a55a184a56510f959b90ddb74e4}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!configure@{configure}}
\index{configure@{configure}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{configure()}{configure()}}
{\footnotesize\ttfamily void configure (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Interfaces with host configure tool. 

The procedure followed is outlined below.

1 -\/ The routine waits to receive an A\+CK from the configure tool.

2 -\/ The bootloader now calculates the hash of the bootloader in memory.

3 -\/ The hash is now sent to the tools over U\+A\+R\+T1. \begin{DoxyVerb}IF   CORRECT - The bootloader proceeds to check the EEPROM installation

IF INCORRECT - The bootloader sets a flag and terminates
\end{DoxyVerb}


3 -\/ The routine waits for an A\+CK from the host tools.

4 -\/ The hash of the E\+E\+P\+R\+OM is now calculated.

5 -\/ That hash is sent over U\+A\+R\+T1 to the host tools. \begin{DoxyVerb}IF   CORRECT - The bootloader terminates.

IF INCORRECT - A flag is set and the bootloader terminates.\end{DoxyVerb}


The procedure followed is outlined below.

1 -\/ The routine waits to receive an A\+CK from the configure tool. 2 -\/ The bootloader now calculates the hash of the bootloader in memory. 3 -\/ The hash is now sent to the tools over U\+A\+R\+T1. IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds to check the E\+E\+P\+R\+OM installation IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader sets a flag and terminates 3 -\/ The routine waits for an A\+CK from the host tools. 4 -\/ The hash of the E\+E\+P\+R\+OM is now calculated. 5 -\/ That hash is sent over U\+A\+R\+T1 to the host tools. IF C\+O\+R\+R\+E\+CT -\/ The bootloader terminates. IF I\+N\+C\+O\+R\+R\+E\+CT -\/ A flag is set and the bootloader terminates. \mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a86b1b361f8d4d2fe6b8b428feba54867}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a86b1b361f8d4d2fe6b8b428feba54867}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!disable\+Clock\+Switching@{disable\+Clock\+Switching}}
\index{disable\+Clock\+Switching@{disable\+Clock\+Switching}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{disable\+Clock\+Switching()}{disableClockSwitching()}}
{\footnotesize\ttfamily void disable\+Clock\+Switching (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Stops Timer0, disabling Clock Switching. 

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3196fd27b969056c23b17850d0839e85}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3196fd27b969056c23b17850d0839e85}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!enable\+Clock\+Switching@{enable\+Clock\+Switching}}
\index{enable\+Clock\+Switching@{enable\+Clock\+Switching}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{enable\+Clock\+Switching()}{enableClockSwitching()}}
{\footnotesize\ttfamily void enable\+Clock\+Switching (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Starts Timer0, enabling Clock Switching. 

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ab7210aaba738ad94e5fd964a5570cee6}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ab7210aaba738ad94e5fd964a5570cee6}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!init\+Timer0@{init\+Timer0}}
\index{init\+Timer0@{init\+Timer0}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{init\+Timer0()}{initTimer0()}}
{\footnotesize\ttfamily void init\+Timer0 (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize Timer0 for clock switching. 

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a9401b6b502308eaaa5813082af1c3046}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a9401b6b502308eaaa5813082af1c3046}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!load\+\_\+firmware@{load\+\_\+firmware}}
\index{load\+\_\+firmware@{load\+\_\+firmware}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{load\+\_\+firmware()}{load\_firmware()}}
{\footnotesize\ttfamily void load\+\_\+firmware (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Loads a new firmware image and release message. 

This function securely loads a new firmware image onto flash. Firmware is encrypted using A\+E\+S-\/256 in C\+FB Mode, and sent one page at a time. It is in the following format\+:

-\/-\/-\/-\/-\/---32000 Bytes-\/-\/-\/-\/-\/--- -\/---256 Bytes-\/-\/---

\mbox{[}Encrypted Firmware Update\mbox{]} \mbox{[}Message M\+AC Page\mbox{]}

The Encrypted Firmware Update section is broken into the following pages\+:

--256 Bytes--- --30720 Bytes--- --1024 Bytes---

\mbox{[}Version Page\mbox{]} \mbox{[}Firmware Pages\mbox{]} \mbox{[}Message Pages\mbox{]}

The version page is constructed in the following format\+:

-\/-\/---2 Bytes-\/--- ---254 Bytes-\/---

\mbox{[}Version Number\mbox{]} \mbox{[}Random Padding\mbox{]}

Each Firmware Page consists of 256 bytes of raw flash. These are obtained via the PC stripping the .hex file generated from the firmware Makefile. Address offsets are added, and blank Flash in the Application Section will be written to 0x\+FF.

The Message Page is 1024 bytes input by the user at F\+W\+\_\+\+P\+R\+O\+T\+E\+CT time. The string is null terminated, and empty bytes in the Message Section will be written to 0x\+FF

The Message M\+AC page is constructed in the following format\+:

--16 Bytes--- ---240 Bytes-\/---

\mbox{[}Message M\+AC\mbox{]} \mbox{[}Random Padding\mbox{]}

The procedure followed is outlined below.

1 -\/ The encrypted firmware image is loaded into the E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON of flash.

2 -\/ The C\+B\+C-\/\+M\+AC of the encrypted firmware image is computed, and compared to the C\+B\+C-\/\+M\+AC sent.

IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds with the firmware upload.

IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader erases E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and terminates.

3 -\/ The firmware image is decrypted and stored in the D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON of flash.

4 -\/ The version number is checked versus the current version, and updated in E\+E\+P\+R\+OM \begin{DoxyVerb}IF   CORRECT - The bootloader proceeds with the firmware upload.

IF INCORRECT - The bootloader erases ENCRYPTED_SECTION and DECRYPTED_SECTION and
               terminate.
\end{DoxyVerb}


5 -\/ The release message is written to the M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON

6 -\/ The firmware is written to the A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON

7 -\/ The bootloader erases E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and terminates

This function securely loads a new firmware image onto flash. Firmware is encrypted using A\+E\+S-\/256 in C\+FB Mode, and sent one page at a time. It is in the following format\+:

-\/-\/-\/-\/-\/---32000 Bytes-\/-\/-\/-\/-\/--- -\/---256 Bytes-\/-\/--- \mbox{[}Encrypted Firmware Update\mbox{]} \mbox{[}Message M\+AC Page\mbox{]}

The Encrypted Firmware Update section is broken into the following pages\+:

--256 Bytes--- --30720 Bytes--- --1024 Bytes--- \mbox{[}Version Page\mbox{]} \mbox{[}Firmware Pages\mbox{]} \mbox{[}Message Pages\mbox{]}

The version page is constructed in the following format\+:

-\/-\/---2 Bytes-\/--- ---254 Bytes-\/--- \mbox{[}Version Number\mbox{]} \mbox{[}Random Padding\mbox{]}

Each Firmware Page consists of 256 bytes of raw flash. These are obtained via the PC stripping the .hex file generated from the firmware Makefile. Address offsets are added, and blank Flash in the Application Section will be written to 0x\+FF.

The Message Page is 1024 bytes input by the user at F\+W\+\_\+\+P\+R\+O\+T\+E\+CT time. The string is null terminated, and empty bytes in the Message Section will be written to 0x\+FF

The Message M\+AC page is constructed in the following format\+:

--16 Bytes--- ---240 Bytes-\/--- \mbox{[}Message M\+AC\mbox{]} \mbox{[}Random Padding\mbox{]}

The procedure followed is outlined below.

1 -\/ The encrypted firmware image is loaded into the E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON of flash. 2 -\/ The C\+B\+C-\/\+M\+AC of the encrypted firmware image is computed, and compared to the C\+B\+C-\/\+M\+AC sent. IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds with the firmware upload. IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader erases E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and terminates. 3 -\/ The firmware image is decrypted and stored in the D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON of flash. 4 -\/ The version number is checked versus the current version, and updated in E\+E\+P\+R\+OM IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds with the firmware upload. IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader erases E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and terminate. 5 -\/ The release message is written to the M\+E\+S\+S\+A\+G\+E\+\_\+\+S\+E\+C\+T\+I\+ON 6 -\/ The firmware is written to the A\+P\+P\+L\+I\+C\+A\+T\+I\+O\+N\+\_\+\+S\+E\+C\+T\+I\+ON 7 -\/ The bootloader erases E\+N\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and D\+E\+C\+R\+Y\+P\+T\+E\+D\+\_\+\+S\+E\+C\+T\+I\+ON and terminates \mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!main@{main}}
\index{main@{main}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2695b90a2a64b6fe11e14c1e2d13f26f}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a2695b90a2a64b6fe11e14c1e2d13f26f}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!program\+\_\+flash@{program\+\_\+flash}}
\index{program\+\_\+flash@{program\+\_\+flash}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{program\+\_\+flash()}{program\_flash()}}
{\footnotesize\ttfamily void program\+\_\+flash (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{page\+\_\+address,  }\item[{unsigned char $\ast$}]{data }\end{DoxyParamCaption})}



Programs a page of A\+T\+Mega1284P flash memory. 

To program flash, you need to access and program it in pages On the atmega1284p, each page is 128 words, or 256 bytes

Programing involves four things,
\begin{DoxyEnumerate}
\item Erasing the page
\item Filling a page buffer
\item Writing a page
\item When you are done programming all of your pages, enable the flash
\end{DoxyEnumerate}

You must fill the buffer one word at a time


\begin{DoxyParams}{Parameters}
{\em page\+\_\+address} & Starting address of page to be programmed \\
\hline
{\em data} & 256-\/byte array of data to be programmed \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a5d4adc248ad2605b7c045108c6a48b1b}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a5d4adc248ad2605b7c045108c6a48b1b}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!readback@{readback}}
\index{readback@{readback}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{readback()}{readback()}}
{\footnotesize\ttfamily void readback (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Interfaces with host readback tool. 

This function allows the factory to read back sections of Application Flash. The tool D\+O\+ES N\+OT read from E\+E\+P\+R\+OM or Bootloader Flash. The 48-\/byte readback request is sent in the following format\+:

-\/-\/---32 Bytes-\/-\/-\/--- -\/-\/-\/---\+\_\+16 Bytes-\/-\/-\/-\/---

\mbox{[}Encrypted Request\mbox{]} \mbox{[}Readback Request M\+AC\mbox{]}

The Encrypted Request encrypted using A\+E\+S-\/256 in C\+FB mode, with a specific Readback Key and Readback Initialization Vector. It is in the following format\+:

-\/-\/-\/---24 Bytes-\/-\/--- -\/---4 Bytes-\/--- ---4 Bytes---

\mbox{[}Readback Password\mbox{]} \mbox{[}Start Address\mbox{]} \mbox{[}End Address\mbox{]}

Although the addresses are byte-\/addressable, this function will dump flash pages (each of which is 256 bytes). The function will begin returning the page containing the starting address, and finish returning the page returning the ending address. Each page is encrypted using the same key and IV and sent back to the PC.

The procedure followed is outlined below.

1 -\/ The encrypted readback request is received

2 -\/ The C\+B\+C-\/\+M\+AC of the encrypted readback request is calculated, and compared to the C\+B\+C-\/\+M\+AC sent.

IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds with the Readback Request

IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader terminates

3 -\/ The readback request is decrypted using the Readback Key and IV

4 -\/ The readback password is checked versus the password stored in the bootloader \begin{DoxyVerb}IF   CORRECT - The bootloader proceeds with the readback request

IF INCORRECT - The bootloader terminates
\end{DoxyVerb}


5 -\/ The bootloader reads in the start address and end address and converts them to start page and end page. The end page is truncated to the page before the B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+S\+E\+C\+T\+I\+ON.

6 -\/ The bootloader begins reading the flash data a page at a time. Each page is encrypted using A\+E\+S-\/256 in C\+FB mode using the Readback Key and IV before being sent to PC.

This function allows the factory to read back sections of Application Flash. The tool D\+O\+ES N\+OT read from E\+E\+P\+R\+OM or Bootloader Flash. The 48-\/byte readback request is sent in the following format\+:

-\/-\/---32 Bytes-\/-\/-\/--- -\/-\/-\/---\+\_\+16 Bytes-\/-\/-\/-\/--- \mbox{[}Encrypted Request\mbox{]} \mbox{[}Readback Request M\+AC\mbox{]}

The Encrypted Request encrypted using A\+E\+S-\/256 in C\+FB mode, with a specific Readback Key and Readback Initialization Vector. It is in the following format\+:

-\/-\/-\/---24 Bytes-\/-\/--- -\/---4 Bytes-\/--- ---4 Bytes--- \mbox{[}Readback Password\mbox{]} \mbox{[}Start Address\mbox{]} \mbox{[}End Address\mbox{]}

Although the addresses are byte-\/addressable, this function will dump flash pages (each of which is 256 bytes). The function will begin returning the page containing the starting address, and finish returning the page returning the ending address. Each page is encrypted using the same key and IV and sent back to the PC.

The procedure followed is outlined below.

1 -\/ The encrypted readback request is received 2 -\/ The C\+B\+C-\/\+M\+AC of the encrypted readback request is calculated, and compared to the C\+B\+C-\/\+M\+AC sent. IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds with the Readback Request IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader terminates 3 -\/ The readback request is decrypted using the Readback Key and IV 4 -\/ The readback password is checked versus the password stored in the bootloader IF C\+O\+R\+R\+E\+CT -\/ The bootloader proceeds with the readback request IF I\+N\+C\+O\+R\+R\+E\+CT -\/ The bootloader terminates 5 -\/ The bootloader reads in the start address and end address and converts them to start page and end page. The end page is truncated to the page before the B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+S\+E\+C\+T\+I\+ON. 6 -\/ The bootloader begins reading the flash data a page at a time. Each page is encrypted using A\+E\+S-\/256 in C\+FB mode using the Readback Key and IV before being sent to PC. 

\subsubsection{Variable Documentation}
\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a4710eb249c76fbcee86e3b3ea93f7ea7}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a4710eb249c76fbcee86e3b3ea93f7ea7}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!E\+E\+M\+EM@{E\+E\+M\+EM}}
\index{E\+E\+M\+EM@{E\+E\+M\+EM}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{E\+E\+M\+EM}{EEMEM}}
{\footnotesize\ttfamily uint16\+\_\+t fw\+\_\+version E\+E\+M\+EM = 1}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac23353dfc159499579eee2c03444f504}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ac23353dfc159499579eee2c03444f504}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!firmware\+IV@{firmware\+IV}}
\index{firmware\+IV@{firmware\+IV}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{firmware\+IV}{firmwareIV}}
{\footnotesize\ttfamily uint8\+\_\+t firmware\+IV\mbox{[}\hyperlink{bootloader_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}\mbox{]} = F\+W\+\_\+\+IV}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3604d93cc7032be26dcca6e694afef50}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a3604d93cc7032be26dcca6e694afef50}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!firmware\+Key@{firmware\+Key}}
\index{firmware\+Key@{firmware\+Key}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{firmware\+Key}{firmwareKey}}
{\footnotesize\ttfamily uint8\+\_\+t firmware\+Key\mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = F\+W\+\_\+\+K\+EY}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a1c67bcd43e103c8093bb6036690ab2e3}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a1c67bcd43e103c8093bb6036690ab2e3}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!hash\+Key@{hash\+Key}}
\index{hash\+Key@{hash\+Key}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{hash\+Key}{hashKey}}
{\footnotesize\ttfamily uint8\+\_\+t hash\+Key\mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = H\+\_\+\+K\+EY}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a36bf49f5e29276a4e9e96bf39a621f80}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a36bf49f5e29276a4e9e96bf39a621f80}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!readback\+Hash\+Key@{readback\+Hash\+Key}}
\index{readback\+Hash\+Key@{readback\+Hash\+Key}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{readback\+Hash\+Key}{readbackHashKey}}
{\footnotesize\ttfamily uint8\+\_\+t readback\+Hash\+Key\mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+H\+\_\+\+K\+EY}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a1b8a8d208ede5763090cb2498cb954de}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a1b8a8d208ede5763090cb2498cb954de}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!readback\+IV@{readback\+IV}}
\index{readback\+IV@{readback\+IV}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{readback\+IV}{readbackIV}}
{\footnotesize\ttfamily uint8\+\_\+t readback\+IV\mbox{[}\hyperlink{bootloader_2main_8c_ad51ded0bbd705f02f73fc60c0b721ced}{B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+\_\+\+IV}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ab712a58833cf27f708f308e3e491a3e7}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_ab712a58833cf27f708f308e3e491a3e7}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!readback\+Key@{readback\+Key}}
\index{readback\+Key@{readback\+Key}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{readback\+Key}{readbackKey}}
{\footnotesize\ttfamily uint8\+\_\+t readback\+Key\mbox{[}\hyperlink{bootloader_2main_8c_a2d996237e082b78b41771b5aa1a6eae1}{K\+E\+Y\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+\_\+\+K\+EY}

\mbox{\Hypertarget{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a68fe00d921fd371e6ed4b5e5c9350fd6}\label{_a_t_mega1284_p___boot_2_a_t_mega1284___boot_2main_8c_a68fe00d921fd371e6ed4b5e5c9350fd6}} 
\index{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}!readback\+Password@{readback\+Password}}
\index{readback\+Password@{readback\+Password}!A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c@{A\+T\+Mega1284\+P\+\_\+\+Boot/\+A\+T\+Mega1284\+\_\+\+Boot/main.\+c}}
\paragraph{\texorpdfstring{readback\+Password}{readbackPassword}}
{\footnotesize\ttfamily uint8\+\_\+t readback\+Password\mbox{[}\hyperlink{bootloader_2main_8c_a6bfdf0e01e9d3de942e38ba284d8ada3}{R\+E\+A\+D\+B\+A\+C\+K\+\_\+\+P\+A\+S\+S\+W\+O\+R\+D\+\_\+\+S\+I\+ZE}\mbox{]} = R\+B\+\_\+\+PW}

